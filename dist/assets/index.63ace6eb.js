import{eE as Ne,eF as Fe,eG as De,eH as Me,eI as Ie,eJ as Oe,cK as me,cQ as ne,eK as $e,eL as Pe,eM as Ue,eN as je,a as ye,s as pe,eO as Ve,c as He,f as D,Z as O,o as F,h as P,i as r,ay as Re,k as I,j as z,x as U,y as ae,z as le,dc as Ye,q as se,n as v,eP as Xe,F as G,ax as ze,cg as qe,az as Ge,aA as Je,eQ as Qe,b8 as Ze,b7 as J,bm as We,cC as et,bu as tt,eR as nt,bT as at,a5 as Q,eS as re,t as ce,ag as H,d3 as lt,aj as st,at as q,eT as rt,d4 as ct,a3 as j,aD as it,eU as ot,ef as dt,cs as ut,b2 as ht,w as ie,v as oe,bF as ft,av as yt,cF as de,eV as pt,br as ue,dd as gt}from"./index.da8cb631.js";import{f as kt}from"./fromPairs.84aabb58.js";import{T as St}from"./index.d148813f.js";import{u as bt}from"./useContextMenu.e3392e8a.js";import{g as xt}from"./get.8113fc0b.js";var Kt=200;function vt(e,a,f,y){var T=-1,x=Me,l=!0,g=e.length,L=[],_=a.length;if(!g)return L;f&&(a=Ne(a,Fe(f))),y?(x=Ie,l=!1):a.length>=Kt&&(x=Oe,l=!1,a=new De(a));e:for(;++T<g;){var k=e[T],c=f==null?k:f(k);if(k=y||k!==0?k:0,l&&c===c){for(var t=_;t--;)if(a[t]===c)continue e;L.push(k)}else x(a,c,y)||L.push(k)}return L}var Lt=me(function(e,a){return ne(e)?vt(e,$e(a,1,ne,!0)):[]}),At=Lt;function Z(e,a){return a?typeof a=="string"?` ${e}--${a}`:Array.isArray(a)?a.reduce((f,y)=>f+Z(e,y),""):Object.keys(a).reduce((f,y)=>f+(a[y]?Z(e,y):""),""):""}function Ct(e){return(a,f)=>(a&&typeof a!="string"&&(f=a,a=""),a=a?`${e}__${a}`:e,`${a}${Z(a,f)}`)}function ge(e){return[Ct(`${Pe}-${e}`)]}const he=Symbol(),fe=Symbol();function _t(e,a){if(!Ue(e)||!!e[fe])return e;const{values:f,required:y,default:T,type:x,validator:l}=e,g=f||l?L=>{let _=!1,k=[];if(f&&(k=[...f,T],_||=k.includes(L)),l&&(_||=l(L)),!_&&k.length>0){const c=[...new Set(k)].map(t=>JSON.stringify(t)).join(", ");je(`Invalid prop: validation failed${a?` for prop "${a}"`:""}. Expected one of [${c}], got value ${JSON.stringify(L)}.`)}return _}:void 0;return{type:typeof x=="object"&&Object.getOwnPropertySymbols(x).includes(he)?x[he]:x,required:!!y,default:T,validator:g,[fe]:!0}}const Et=e=>kt(Object.entries(e).map(([a,f])=>[a,_t(f,a)]));var E=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(E||{});const Tt=["update:expandedKeys","update:selectedKeys","update:value","change","check","update:searchValue"],wt=Et({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array,default:()=>[]},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:Array,default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1}}),Bt={key:2,class:"flex items-center flex-1 cursor-pointer justify-self-stretch"},Nt=ye({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search"],setup(e,{emit:a}){const f=e,y=pe(""),[T]=ge("tree-header"),x=Ve(),{t:l}=He(),g=D(()=>{const t=x.headerTitle||f.title;return["mr-1","w-full",{["ml-5"]:t}]}),L=D(()=>{const{checkable:t}=f,s=[{label:l("component.tree.expandAll"),value:E.EXPAND_ALL},{label:l("component.tree.unExpandAll"),value:E.UN_EXPAND_ALL,divider:t}];return t?[{label:l("component.tree.selectAll"),value:E.SELECT_ALL},{label:l("component.tree.unSelectAll"),value:E.UN_SELECT_ALL,divider:t},...s,{label:l("component.tree.checkStrictly"),value:E.CHECK_STRICTLY},{label:l("component.tree.checkUnStrictly"),value:E.CHECK_UN_STRICTLY}]:s});function _(t){const{key:s}=t;switch(s){case E.SELECT_ALL:f.checkAll?.(!0);break;case E.UN_SELECT_ALL:f.checkAll?.(!1);break;case E.EXPAND_ALL:f.expandAll?.(!0);break;case E.UN_EXPAND_ALL:f.expandAll?.(!1);break;case E.CHECK_STRICTLY:a("strictly-change",!1);break;case E.CHECK_UN_STRICTLY:a("strictly-change",!0);break}}function k(t){a("search",t)}const c=tt(k,200);return O(()=>y.value,t=>{c(t)}),O(()=>f.searchText,t=>{t!==y.value&&(y.value=t)}),(t,s)=>(F(),P("div",{class:se([r(T)(),"flex px-2 py-1.5 items-center"])},[r(x).headerTitle?Re(t.$slots,"headerTitle",{key:0}):I("",!0),!r(x).headerTitle&&t.title?(F(),z(r(Ye),{key:1,helpMessage:t.helpMessage},{default:U(()=>[ae(le(t.title),1)]),_:1},8,["helpMessage"])):I("",!0),t.search||t.toolbar?(F(),P("div",Bt,[t.search?(F(),P("div",{key:0,class:se(r(g))},[v(r(Xe),{placeholder:r(l)("common.searchText"),size:"small",allowClear:"",value:y.value,"onUpdate:value":s[0]||(s[0]=i=>y.value=i)},null,8,["placeholder","value"])],2)):I("",!0),t.toolbar?(F(),z(r(et),{key:1,onClick:s[1]||(s[1]=We(()=>{},["prevent"]))},{overlay:U(()=>[v(r(Ze),{onClick:_},{default:U(()=>[(F(!0),P(G,null,ze(r(L),i=>(F(),P(G,{key:i.value},[v(r(qe),Ge(Je({key:i.value})),{default:U(()=>[ae(le(i.label),1)]),_:2},1040),i.divider?(F(),z(r(Qe),{key:0})):I("",!0)],64))),128))]),_:1})]),default:U(()=>[v(r(J),{icon:"ion:ellipsis-vertical"})]),_:1})):I("",!0)])):I("",!0)],2))}}),Ft=({icon:e})=>e?nt(e)?at(J,{icon:e,class:"mr-1"}):J:null;function Dt(e,a){function f(c){const t=[],s=c||r(e),{key:i,children:o}=r(a);if(!o||!i)return t;for(let u=0;u<s.length;u++){const d=s[u];t.push(d[i]);const p=d[o];p&&p.length&&t.push(...f(p))}return t}function y(c){const t=[],s=c||r(e),{key:i,children:o}=r(a);if(!o||!i)return t;for(let u=0;u<s.length;u++){const d=s[u];d.disabled!==!0&&d.selectable!==!1&&t.push(d[i]);const p=d[o];p&&p.length&&t.push(...y(p))}return t}function T(c,t){const s=[],i=t||r(e),{key:o,children:u}=r(a);if(!u||!o)return s;for(let d=0;d<i.length;d++){const p=i[d],C=p[u];c===p[o]?(s.push(p[o]),C&&C.length&&s.push(...f(C))):C&&C.length&&s.push(...T(c,C))}return s}function x(c,t,s){if(!c)return;const i=s||r(e),{key:o,children:u}=r(a);if(!(!u||!o))for(let d=0;d<i.length;d++){const p=i[d],C=p[u];if(p[o]===c){i[d]={...i[d],...t};break}else C&&C.length&&x(c,t,p[u])}}function l(c=1,t,s=1){if(!c)return[];const i=[],o=t||r(e)||[];for(let u=0;u<o.length;u++){const d=o[u],{key:p,children:C}=r(a),R=p?d[p]:"",m=C?d[C]:[];i.push(R),m&&m.length&&s<c&&(s+=1,i.push(...l(c,m,s)))}return i}function g({parentKey:c=null,node:t,push:s="push"}){const i=Q(r(e));if(!c){i[s](t),e.value=i;return}const{key:o,children:u}=r(a);!u||!o||(re(i,d=>{if(d[o]===c)return d[u]=d[u]||[],d[u][s](t),!0}),e.value=i)}function L({parentKey:c=null,list:t,push:s="push"}){const i=Q(r(e));if(!(!t||t.length<1))if(c){const{key:o,children:u}=r(a);if(!u||!o)return;re(i,d=>{if(d[o]===c){d[u]=d[u]||[];for(let p=0;p<t.length;p++)d[u][s](t[p]);return e.value=i,!0}})}else for(let o=0;o<t.length;o++)i[s](t[o])}function _(c,t){if(!c)return;const s=t||r(e),{key:i,children:o}=r(a);if(!(!o||!i))for(let u=0;u<s.length;u++){const d=s[u],p=d[o];if(d[i]===c){s.splice(u,1);break}else p&&p.length&&_(c,d[o])}}function k(c,t,s){return!c&&c!==0?null:((t||r(e)).forEach(o=>{if(s?.key||s?.key===0)return s;if(o.key===c){s=o;return}o.children&&o.children.length&&(s=k(c,o.children,s))}),s||null)}return{deleteNodeByKey:_,insertNodeByKey:g,insertNodesByKey:L,filterByLevel:l,updateNodeByKey:x,getAllKeys:f,getChildrenKeys:T,getEnabledKeys:y,getSelectedNode:k}}function Mt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ut(e)}var Ut=ye({name:"BasicTree",inheritAttrs:!1,props:wt,emits:Tt,setup(e,{attrs:a,slots:f,emit:y,expose:T}){const[x]=ge("tree"),l=ce({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),g=ce({startSearch:!1,searchText:"",searchData:[]}),L=pe([]),[_]=bt(),k=D(()=>{const{fieldNames:n}=e;return{children:"children",title:"title",key:"key",...n}}),c=D(()=>{let n={blockNode:!0,...a,...e,expandedKeys:l.expandedKeys,selectedKeys:l.selectedKeys,checkedKeys:l.checkedKeys,checkStrictly:l.checkStrictly,fieldNames:r(k),"onUpdate:expandedKeys":h=>{l.expandedKeys=h,y("update:expandedKeys",h)},"onUpdate:selectedKeys":h=>{l.selectedKeys=h,y("update:selectedKeys",h)},onCheck:(h,K)=>{let S=H(l.checkedKeys);if(lt(S)&&g.startSearch){const{key:A}=r(k);S=At(S,R(K.node.$attrs.node[A])),K.checked&&S.push(K.node.$attrs.node[A]),l.checkedKeys=S}else l.checkedKeys=h;const b=H(l.checkedKeys);y("update:value",b),y("check",b,K)},onRightClick:be};return st(n,"treeData","class")}),t=D(()=>g.startSearch?g.searchData:r(L)),s=D(()=>!t.value||t.value.length===0),{deleteNodeByKey:i,insertNodeByKey:o,insertNodesByKey:u,filterByLevel:d,updateNodeByKey:p,getAllKeys:C,getChildrenKeys:R,getEnabledKeys:m,getSelectedNode:ke}=Dt(L,k);function Se(n,h){return!h&&e.renderIcon&&q(e.renderIcon)?e.renderIcon(n):h}async function be({event:n,node:h}){const{rightMenuList:K=[],beforeRightClick:S}=e;let b={event:n,items:[]};if(S&&q(S)){let A=await S(h,n);Array.isArray(A)?b.items=A:Object.assign(b,A)}else b.items=K;!b.items?.length||(b.items=b.items.filter(A=>!A.hidden),_(b))}function V(n){l.expandedKeys=n}function xe(){return l.expandedKeys}function W(n){l.selectedKeys=n}function Ke(){return l.selectedKeys}function ee(n){l.checkedKeys=n}function ve(){return l.checkedKeys}function te(n){l.checkedKeys=n?m():[]}function Y(n){l.expandedKeys=n?C():[]}function Le(n){l.checkStrictly=n}O(()=>e.searchValue,n=>{n!==g.searchText&&(g.searchText=n)},{immediate:!0}),O(()=>e.treeData,n=>{n&&X(g.searchText)});function X(n){if(n!==g.searchText&&(g.searchText=n),y("update:searchValue",n),!n){g.startSearch=!1;return}const{filterFn:h,checkable:K,expandOnSearch:S,checkOnSearch:b,selectedOnSearch:A}=r(e);g.startSearch=!0;const{title:$,key:M}=r(k),B=[];if(g.searchData=rt(r(L),w=>{const N=h?h(n,w,r(k)):w[$]?.includes(n)??!1;return N&&B.push(w[M]),N},r(k)),S){const w=ct(g.searchData).map(N=>N[M]);w&&w.length&&V(w)}b&&K&&B.length&&ee(B),A&&B.length&&W(B)}function Ae(n,h){if(!(!e.clickRowToExpand||!h||h.length===0))if(!l.expandedKeys.includes(n))V([...l.expandedKeys,n]);else{const K=[...l.expandedKeys],S=K.findIndex(b=>b===n);S!==-1&&K.splice(S,1),V(K)}}j(()=>{L.value=e.treeData}),it(()=>{const n=parseInt(e.defaultExpandLevel);n>0?l.expandedKeys=d(n):e.defaultExpandAll&&Y(!0)}),j(()=>{l.expandedKeys=e.expandedKeys}),j(()=>{l.selectedKeys=e.selectedKeys}),j(()=>{l.checkedKeys=e.checkedKeys}),O(()=>e.value,()=>{l.checkedKeys=H(e.value||[])},{immediate:!0}),O(()=>l.checkedKeys,()=>{const n=H(l.checkedKeys);y("update:value",n),y("change",n)}),j(()=>{l.checkStrictly=e.checkStrictly});const Ce={setExpandedKeys:V,getExpandedKeys:xe,setSelectedKeys:W,getSelectedKeys:Ke,setCheckedKeys:ee,getCheckedKeys:ve,insertNodeByKey:o,insertNodesByKey:u,deleteNodeByKey:i,updateNodeByKey:p,getSelectedNode:ke,checkAll:te,expandAll:Y,filterByLevel:n=>{l.expandedKeys=d(n)},setSearchValue:n=>{X(n)},getSearchValue:()=>g.searchText};function _e(n){const{actionList:h}=e;if(!(!h||h.length===0))return h.map((K,S)=>{let b=!0;return q(K.show)?b=K.show?.(n):ue(K.show)&&(b=K.show),b?v("span",{key:S,class:x("action")},[K.render(n)]):null})}const Ee=D(()=>{const n=Q(t.value);return ot(n,(h,K)=>{const S=g.searchText,{highlight:b}=r(e),{title:A,key:$,children:M}=r(k),B=Se(h,h.icon),w=xt(h,A),N=S?w.indexOf(S):-1,Te=g.startSearch&&!pt(S)&&b&&N!==-1,we=`color: ${ue(b)?"#f50":b}`,Be=Te?v("span",{class:r(c)?.blockNode?`${x("content")}`:""},[v("span",null,[w.substr(0,N)]),v("span",{style:we},[S]),v("span",null,[w.substr(N+S.length)])]):w;return h[A]=v("span",{class:`${x("title")} pl-2`,onClick:Ae.bind(null,h[$],h[M])},[f?.title?gt(f,"title",h):v(G,null,[B&&v(Ft,{icon:B},null),Be,v("span",{class:x("actions")},[_e(h)])])]),h}),n});return T(Ce),()=>{let n;const{title:h,helpMessage:K,toolbar:S,search:b,checkable:A}=e,$=h||S||b||f.headerTitle,M={height:"calc(100% - 38px)"};return v("div",{class:[x(),"h-full",a.class]},[$&&v(Nt,{checkable:A,checkAll:te,expandAll:Y,title:h,search:b,toolbar:S,helpMessage:K,onStrictlyChange:Le,onSearch:X,searchText:g.searchText},Mt(n=dt(f))?n:{default:()=>[n]}),v(ht,{spinning:r(e.loading),tip:"\u52A0\u8F7D\u4E2D..."},{default:()=>[ie(v(ft,{style:M},{default:()=>[v(St,yt(r(c),{showIcon:!1,treeData:Ee.value}),null)]}),[[oe,!r(s)]]),ie(v(de,{image:de.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[oe,r(s)]])]})])}}});export{Ut as _};
